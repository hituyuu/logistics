(function(){var i,r,n,u,f,e,o,t;e=$("#province");i=$("#city");r=$("#county");u=$("#district");f=$("#site-form");t=$("#sites");o=$("#query");$("#site-btn").on("click ",function(){var h,c,l,a,s,n;if(h=$.trim(u.val()),a=$.trim(o.val()),h||a)return h=h.split("-"),e.val(h[0]||""),i.val(h[1]||""),r.val(h[2]||""),s=f.serializeObject(),s.query=$.trim(s.query),n="",l=!0,c="",s.county||s.city?n="county":s.province?n="city":s.query&&(n="city",l=!1),n==="city"&&l&&(c=" query-city"),api.call("querySites",{data:s,success:function(i){var o,u,f,r,s,e;for(f=[],i.data=i.data||[],e=i.data,r=0,s=e.length;r<s;r++)u=e[r],u.name!=null&&f.push(u);return o=_.groupBy(f,function(t){var i;return n==="county"?i=t.province+"-"+t.city+t[n]:n==="city"&&(i=t.province+"-"+t[n]),i}),View.render("sites",{data:o,type:n,klass:c}),$("#site-map").hide(),$("#site-detail").hide(),t.show()}})});$("#hot a").click(function(){return $("#district").val($(this).data("fullname")),View.activeBtn("#site-btn"),$("#site-btn").click(),!1});$("#sites").delegate(".query-city","click",function(){return $("#district").val($(this).attr("title")),View.activeBtn("#site-btn"),$("#site-btn").click(),!1});$("#map-btn").on("click",function(){return $("#site-map").toggle(),!1});$("#map area").on("click",function(){var n;return n=$(this).attr("href"),$("#district").val(n),View.activeBtn("#site-btn"),$("#site-btn").click(),!1});n=$("#site-detail");t.delegate("a","click",function(){var t,i;return t=$(this),i=t.attr("href").substring(1),api.call("querySiteDetail",{url:api.querySiteDetail.url(i),success:function(i){var r,u;if(i.success||!0)return i.data?i.data._data=!0:i.data={name:t.attr("title"),_data:!1},i.data.fax||(i.data.fax=""),r=$("#query").val(),u=new RegExp(""+r,"ig"),r&&i.data.range&&(i.data.range=i.data.range.replace(u,'<span class="font-red">$&<\/span>')),n.removeClass("loading"),View.render("site-detail",i.data)}},!1)});n.on("hidden",function(){return n.empty().addClass("loading"),$("html,body").css("overflow","auto")});n.on("show",function(){return $("html,body").css("overflow","hidden")});$("#district,#query").on("input propertychange",function(){var n;return n=$("#district").val()+$("#query"),n?View.activeBtn("#site-btn"):View.disableBtn("#site-btn")});$("#district-selector").delegate(".district-item","click",function(){var n;return n=$("#district").val()+$("#query"),n?View.activeBtn("#site-btn"):View.disableBtn("#site-btn")});View.activeNavIndex=3}).call(this)